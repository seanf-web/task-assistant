<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TASK Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      /* LIGHT THEME */
      --bg-grad-a:#ecf5fb;
      --bg-grad-b:#dbeef7;

      --surface:#ffffff;
      --surface-2:#f6f8fa;
      --border:#d9e3ec;

      --text:#1a2b3c;
      --text-muted:#5f7488;

      --brand-blue:#145078;
      --brand-teal:#33A7B5;
      --brand-blue-accent:#0085CA;
      --brand-orange:#ff911f;
      --brand-yellow:#ffc91f;
      --brand-green:#74ba58;

      --chip-bg:#ffffff;
      --chip-border:#ffc17a;

      --bot-bubble-bg:#ffffff;
      --bot-bubble-br:#0085CA;

      --user-bubble-a:#ff911f;
      --user-bubble-b:#ffc91f;

      --input-bg:#ffffff;
      --input-br:#0085CA;

      --rail-bg:#f7fbff;
      --rail-link:#145078;

      --shadow:0 20px 40px rgba(20,80,120,.28);
    }

    /* DARK THEME ‚Äî calmer palette, better contrast */
    [data-theme="dark"]{
      --bg-grad-a:#0b1a27;
      --bg-grad-b:#0e2a45;

      --surface:#0f2233;
      --surface-2:#0b1c2a;
      --border:#1f3548;

      --text:#e7f0f7;
      --text-muted:#aecdde;

      --chip-bg:#133149;
      --chip-border:#2f5471;

      --bot-bubble-bg:#0f2233;
      --bot-bubble-br:#2e83c1;

      --input-bg:#102537;
      --input-br:#2e83c1;

      --rail-bg:#0b1c2a;
      --rail-link:#d9ecfa;

      --shadow:0 14px 28px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;
      background:linear-gradient(135deg,var(--bg-grad-a) 0%,var(--bg-grad-b) 100%);
      color:var(--text);
    }

    .app{
      position:relative;width:100%;max-width:420px;background:var(--surface);
      border:3px solid var(--brand-orange);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);
    }

    .header{
      display:flex;align-items:center;gap:10px;justify-content:center;position:relative;
      border-bottom:2px solid var(--brand-blue);padding:12px 12px 10px;background:var(--surface)
    }
    .badge{display:inline-block;background:var(--brand-blue);color:#fff;padding:6px 12px;border-radius:999px;
      font:700 13px/1 "Nunito",sans-serif;letter-spacing:.2px}
    .subline{margin-top:4px;color:var(--brand-orange);font:700 12px/1 "Nunito",sans-serif}

    /* Theme toggle */
    .theme-toggle{position:absolute;right:10px;top:10px;border:none;border-radius:999px;
      width:34px;height:34px;cursor:pointer;background:#ffe7cc;color:#5c3e00;
      display:grid;place-items:center;font-weight:700}
    [data-theme="dark"] .theme-toggle{background:#103046;color:#ffe199}

    /* Top rail */
    .rail{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
      padding:10px 12px;background:var(--rail-bg);border-bottom:1px solid var(--border)
    }
    .rail a{
      font-weight:600;text-decoration:none;color:var(--rail-link);
      border:1px solid var(--chip-border);background:var(--chip-bg);border-radius:999px;
      padding:6px 10px;font-size:12px;display:inline-flex;gap:6px;align-items:center
    }
    .rail a:hover{background:var(--brand-orange);border-color:var(--brand-orange);color:#fff}

    .chat{height:360px;overflow:auto;background:var(--surface-2);padding:14px;scroll-behavior:smooth}

    .msg{margin:12px 0;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.45;animation:fade-in .16s ease}
    .user{
      margin-left:20%;text-align:right;color:#fff;
      background:linear-gradient(135deg,var(--user-bubble-a),var(--user-bubble-b));
      border-radius:16px 16px 4px 16px;box-shadow:0 4px 12px rgba(255,145,31,.28)
    }
    .bot{
      margin-right:20%;background:var(--bot-bubble-bg);border:2px solid var(--bot-bubble-br);
      color:var(--text);border-radius:16px 16px 16px 4px;box-shadow:0 3px 10px rgba(0,133,202,.12)
    }
    .title-chip{
      display:inline-block;background:linear-gradient(90deg,var(--brand-orange),var(--brand-yellow));
      color:#fff;border-radius:999px;padding:8px 16px;font-weight:700;margin:2px 0 8px 6px;font-size:13px
    }

    .typing{display:flex;align-items:center;gap:6px;background:#e8edf2;color:#4b5a69}
    [data-theme="dark"] .typing{background:#123047;color:#b7d7ee}
    .dot{width:6px;height:6px;border-radius:50%;background:currentColor;animation:bob 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}

    .footer{padding:12px;background:var(--surface-2);border-top:2px solid var(--bot-bubble-br)}
    .hint{font-size:11px;color:var(--brand-blue);
      background:linear-gradient(135deg,rgba(116,186,88,.12),rgba(51,167,181,.12));
      border:2px solid var(--brand-green);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px}
    [data-theme="dark"] .hint{color:#bfe6ff}

    .inputrow{display:flex;gap:10px;align-items:center}
    input[type="text"]{
      flex:1;padding:14px 16px;border:2px solid var(--input-br);border-radius:25px;font-size:13px;outline:none;background:var(--input-bg);
      color:var(--text)
    }
    input[type="text"]::placeholder{color:var(--text-muted)}
    input[type="text"]:focus{border-color:var(--brand-orange)}
    button.send{
      width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:18px;
      background:linear-gradient(135deg,var(--brand-orange),var(--brand-yellow));box-shadow:0 4px 15px rgba(255,145,31,.28)
    }
    .status{margin-top:6px;text-align:center;font-size:10px;color:var(--text-muted)}

    @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}

    @media (max-width:480px){ .app{border-radius:16px}}
  </style>
</head>
<body>
  <main class="app" id="app" data-theme="light">
    <div class="header">
      <button class="theme-toggle" id="themeBtn" title="Toggle theme">‚òº</button>
      <div>
        <div class="badge">TASK Assistant</div>
        <div class="subline">Trenton Area Soup Kitchen</div>
      </div>
    </div>

    <!-- Top rail -->
    <nav class="rail" id="top-rail">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">üìç Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">üíº Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">üîî Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">üéì Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">üìÑ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">üé• Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">üß∞ Resources</a>
    </nav>

    <section class="chat" id="chat"></section>

    <footer class="footer">
      <div class="hint" id="hint">I speak English, Espa√±ol & Krey√≤l</div>
      <div class="inputrow">
        <input id="box" type="text" placeholder="Type: training, jobs, hours, address, bus‚Ä¶" autocomplete="off"/>
        <button class="send" id="send" aria-label="Send">‚û§</button>
      </div>
      <div class="status" id="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!</div>
    </footer>
  </main>
</body>
<script>
  // ==== THEME ===============================================================
  const appEl = document.getElementById('app');
  const themeBtn = document.getElementById('themeBtn');
  const savedTheme = localStorage.getItem('taskTheme') || 'light';
  setTheme(savedTheme);

  themeBtn.addEventListener('click', () => {
    setTheme(appEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
  });

  function setTheme(mode){
    appEl.setAttribute('data-theme', mode);
    localStorage.setItem('taskTheme', mode);
    themeBtn.textContent = mode === 'dark' ? '‚òæ' : '‚òº';
  }

  // ==== DOM helpers =========================================================
  const chat  = document.getElementById('chat');
  const box   = document.getElementById('box');
  const send  = document.getElementById('send');
  const statusEl = document.getElementById('status');
  const hintEl   = document.getElementById('hint');

  function addUser(text){
    const el = document.createElement('div');
    el.className = 'msg user';
    el.textContent = text;
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  }
  function addBot(html, title){
    const wrap = document.createElement('div');
    wrap.className = 'msg bot';
    wrap.innerHTML = (title ? `<div class="title-chip">${title}</div>` : '') + html;
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
  }
  function typingOn(){
    const t = document.createElement('div');
    t.className = 'msg typing'; t.id='typing';
    t.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
    chat.appendChild(t); chat.scrollTop = chat.scrollHeight;
  }
  function typingOff(){ const t=document.getElementById('typing'); if(t) t.remove(); }

  // ==== LANGUAGE ============================================================
  // Start in English; switch to ES/HT when detected; only switch back when asked.
  let currentLang = localStorage.getItem('taskLang') || 'en';

  const explicitLang = {
    en: /(english|in english|back to english|speak english|switch to english)\b/i,
    es: /(espa√±ol|en espa√±ol|habla espa√±ol|spanish please|espanol)\b/i,
    ht: /(krey[o√≤]l|pale krey[o√≤]l|an krey[o√≤]l|creole please)\b/i
  };

  function detectLang(t){
    t = t.toLowerCase();
    const es = /hola|necesito|trabajo|empleo|d[o√≥]nde|cuando|hora|horario|comida|cita|servicio|direcci[o√≥]n|autob[u√∫]s|entrenamiento|curr[i√≠]culum|ayuda/.test(t);
    const ht = /bonjou|bonswa|mwen|bezwen|travay|kote|ede|manje|krey[o√≤]l|telef[o√≤]n|adr[e√®]s|randevou|s[e√®]vis|autobis|f√≤masyon/.test(t);
    return es ? 'es' : (ht ? 'ht' : 'en');
  }

  function maybeSwitchLanguage(userText){
    // Explicit requests always win
    if (explicitLang.en.test(userText)){ currentLang='en'; }
    else if (explicitLang.es.test(userText)){ currentLang='es'; }
    else if (explicitLang.ht.test(userText)){ currentLang='ht'; }
    else {
      // Auto-switch into ES/HT if strong signals and not already in that lang.
      const guess = detectLang(userText);
      if (guess !== 'en' && currentLang !== guess){ currentLang = guess; }
      // NOTE: we DO NOT auto-switch back to English ‚Äî user must ask.
    }
    localStorage.setItem('taskLang', currentLang);
    updateHint();
  }

  function updateHint(){
    hintEl.textContent =
      currentLang==='es' ? 'Hablo ingl√©s, espa√±ol (y Krey√≤l)' :
      currentLang==='ht' ? 'M pale angle, pany√≤l & krey√≤l' :
                           'I speak English, Espa√±ol & Krey√≤l';
    box.placeholder =
      currentLang==='es' ? 'Escribe: entrenamientos, empleos, horarios, direcci√≥n, bus‚Ä¶' :
      currentLang==='ht' ? 'Ekri: f√≤masyon, travay, l√® manje, adr√®s, bis‚Ä¶' :
                           'Type: training, jobs, hours, address, bus‚Ä¶';
  }

  // ==== COPY (strings) ======================================================
  function T(){
    if (currentLang==='es') return {
      youAsked: s=>`‚Ä¢ Preguntaste sobre ${s}.`,
      callSSS:  `Llama al Especialista de Servicios Sociales al <a href="tel:609-337-1624">(609) 337-1624</a>. Durante el almuerzo (10:30 AM‚Äì1:00 PM).`,
      trainingTitle:'Entrenamientos',
      jobsTitle:'Empleos',
      alertsTitle:'Alertas',
      resumeTitle:'Curr√≠culum',
      apptTitle:'Citas',
      hoursTitle:'Horarios',
      locationTitle:'Ubicaci√≥n',
      transitTitle:'Transporte',
      labTitle:'Computadoras',
      resourcesTitle:'Recursos',
      hello: `¬°Hola! Dime <em>entrenamientos</em>, <em>empleos</em>, <em>horarios</em>, <em>direcci√≥n</em> o <em>autob√∫s</em>.`,
      quick:`Enlaces r√°pidos: <a href="https://bycell.co/ddmtn" target="_blank">Entrenamientos</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank">Empleos</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank">Alertas</a>`,
      empathy:(friendly)=> friendly
        ? `Entiendo ‚Äî a veces esto frustra. Puedo simplificar o conectarte con una persona.` 
        : `Lo siento, parece frustrante. Si prefieres hablar con alguien, ${'llama'} ${'al'} <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      talkToHuman:`¬øDeseas hablar con alguien ahora? Llama: <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      options:`Opciones:`,
      btnTraining:'Training',
      btnJobs:'Open Jobs',
      btnAddress:'Address',
      btnBus:'Bus to TASK'
    };
    if (currentLang==='ht') return {
      youAsked: s=>`‚Ä¢ Ou te mande sou ${s}.`,
      callSSS:  `Rele Espesyalis S√®vis Sosyal la nan <a href="tel:609-337-1624">(609) 337-1624</a>. Pandan l√® manje midi (10:30 AM‚Äì1:00 PM).`,
      trainingTitle:'F√≤masyon',
      jobsTitle:'Travay',
      alertsTitle:'Al√®t',
      resumeTitle:'CV',
      apptTitle:'Randevou',
      hoursTitle:'Or√®',
      locationTitle:'Kote',
      transitTitle:'Transp√≤',
      labTitle:'Labo √ídinat√®',
      resourcesTitle:'Resous',
      hello:`Bonjou! Di mwen <em>f√≤masyon</em>, <em>travay</em>, <em>or√®</em>, <em>adr√®s</em> oswa <em>bis</em>.`,
      quick:`Lyen rapid: <a href="https://bycell.co/ddmtn" target="_blank">F√≤masyon</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank">Travay</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank">Al√®t</a>`,
      empathy:(friendly)=> friendly
        ? `Mwen konprann ‚Äî sa ka bay fristrasyon. Mwen ka senplifye oswa konekte w ak yon moun.` 
        : `Padon, sa a sanble fristran. Si w ta renmen pale ak yon moun, rele <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      talkToHuman:`Vle pale ak yon moun? Rele: <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      options:`Opsyon:`,
      btnTraining:'Training',
      btnJobs:'Open Jobs',
      btnAddress:'Address',
      btnBus:'Bus to TASK'
    };
    // EN
    return {
      youAsked: s=>`‚Ä¢ You asked about ${s}.`,
      callSSS:  `Call Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a>. During lunch (10:30 AM‚Äì1:00 PM).`,
      trainingTitle:'Training',
      jobsTitle:'Jobs',
      alertsTitle:'Alerts',
      resumeTitle:'Resume',
      apptTitle:'Appointment',
      hoursTitle:'Hours',
      locationTitle:'Location',
      transitTitle:'Transit',
      labTitle:'Computer Lab',
      resourcesTitle:'Resources',
      hello:`Hello! Tell me <em>training</em>, <em>jobs</em>, <em>hours</em>, <em>address</em>, or <em>bus</em>.`,
      quick:`Quick links: <a href="https://bycell.co/ddmtn" target="_blank">Training</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank">Jobs</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank">Alerts</a>`,
      empathy:(friendly)=> friendly
        ? `I hear you ‚Äî this can be frustrating. I can simplify or connect you with a person.` 
        : `Sorry this is frustrating. If you‚Äôd rather talk to a person, call <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      talkToHuman:`Want a person now? Call: <a href="tel:609-337-1624">(609) 337-1624</a>.`,
      options:`Options:`,
      btnTraining:'Training',
      btnJobs:'Open Jobs',
      btnAddress:'Address',
      btnBus:'Bus to TASK'
    };
  }

  // ==== INTENT + frustration ===============================================
  function classifyIntent(text){
    const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');
    const bag = {
      trainings: /(training|trainings|program|programs|class|classes|course|courses|certification|culinary|emilio|academy|sora|forklift|apprenticeship)\b|entrenamiento|entrenamientos|formaci[o√≥]n|f√≤masyon/,
      jobs: /(job|jobs|work|employment|hiring|hire|opening|openings|apply|application|position|positions)\b|empleo|empleos|trabajo|travay/,
      alerts: /(alert|alerts|notify|notification|subscribe|updates)\b|alerta|alertas|al√®t/,
      resume: /(resume|curriculum|curr[i√≠]culum|cv|cover\s*letter)\b|curriculum|curr[i√≠]culum|cv/,
      interview: /(interview|interview\s*tips|mock\s*interview|practice\s*interview)\b|entrevista|ent√®vyou/,
      appointments: /(appointment|schedule|book|meeting|register|sign\s*up|rsvp|cita|programar|randevou)\b/,
      hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|horario|almuerzo|cena|manje)\b/,
      location: /(where|address|location|directions|map|parking|d[o√≥]nde|direcci[o√≥]n|ubicaci[o√≥]n|kote|adr[e√®]s)\b/,
      transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner|autob[u√∫]s|transporte|otobis|transp[o√≤])\b/,
      computer_lab: /(computer|internet|wifi|lab|email|application\s*online|computadora|labo)\b/,
      resources: /(resource|resources|assistance|support\s*services|legal|mental|housing|benefits|servicios|resursos|resous)\b/,
      greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
      thanks: /(thanks|thank you|gracias|mesi)\b/
    };
    for (const [k, rx] of Object.entries(bag)){ if (rx.test(t)) return k; }
    return 'default';
  }

  function isFrustrated(text){
    const rx = /(frustrat|upset|angry|annoyed|this (is )?sucks?|not working|broken|useless|confused|don'?t understand|wtf|human|real person|representative|agent|operator|talk to someone|speak to someone|can i talk|need a person|help me|help now)/i;
    return rx.test(text);
  }

  // ==== ROUTES ==============================================================

  function route(text){
    const L = T();
    const intent = classifyIntent(text);

    // Escalation & empathy
    if (isFrustrated(text)) {
      addBot(`${L.empathy(true)}<br><br>${L.talkToHuman}`, 'Support');
      // Also offer two quick pivots
      addBot(`${L.options} <a href="https://bycell.co/ddmtq" target="_blank">Jobs</a> ‚Ä¢ <a href="https://bycell.co/ddmtn" target="_blank">Training</a>`);
      return;
    }

    switch (intent){
      case 'trainings':
        addBot(`${L.youAsked(L.trainingTitle)}<br><br>
            ‚Ä¢ Emilio Culinary Academy (10 weeks)<br>
            ‚Ä¢ SORA Security Certification<br>
            ‚Ä¢ Forklift Certification<br><br>
            <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Browse training & apply</a><br>${L.callSSS}`,
            L.trainingTitle);
        return;

      case 'jobs':
        addBot(`${L.youAsked(L.jobsTitle)}<br><br>
            <a href="https://bycell.co/ddmtq" target="_blank">Open positions</a> ‚Ä¢ 
            <a href="https://bycell.co/ddmtr" target="_blank">Get job alerts</a><br><br>
            Need help applying? ${L.callSSS}`, L.jobsTitle);
        return;

      case 'alerts':
        addBot(`${L.youAsked(L.alertsTitle)}<br><br>
            <a href="https://bycell.co/ddmtr" target="_blank">Subscribe to job alerts</a>`, L.alertsTitle);
        return;

      case 'resume':
        addBot(`${L.youAsked(L.resumeTitle)}<br><br>
            <a href="https://bycell.co/ddmui" target="_blank">Resume help & templates</a><br><br>${L.callSSS}`, L.resumeTitle);
        return;

      case 'appointments':
        // Per your request: no ‚Äúregister online‚Äù here ‚Äî phone only.
        addBot(`${L.youAsked(L.apptTitle)}<br><br>${L.callSSS}`, L.apptTitle);
        return;

      case 'hours':
        addBot(`${L.youAsked(L.hoursTitle)}<br><br>
            Meals: Lunch Mon‚ÄìFri 10:30a‚Äì1:00p ‚Ä¢ Dinner Mon‚ÄìThu 3:30‚Äì5:00p<br>
            Employment appointments are scheduled during lunch.`, L.hoursTitle);
        return;

      case 'location':
        addBot(`${L.youAsked(L.locationTitle)}<br><br>
            72¬Ω Escher St, Trenton, NJ 08609<br>
            <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank">Open Google Maps</a><br><br>${L.callSSS}`, L.locationTitle);
        return;

      case 'transit':
        addBot(`${L.youAsked(L.transitTitle)}<br><br>
            <a href="https://www.njtransit.com/trip-planner-to" target="_blank">NJ Transit Trip Planner</a> ‚Ä¢ 1-973-275-5555<br>
            Destination: 72¬Ω Escher St, Trenton.`, L.transitTitle);
        return;

      case 'computer_lab':
        addBot(`${L.youAsked(L.labTitle)}<br><br>
            Open during meal hours. Free internet & job applications.`, L.labTitle);
        return;

      case 'resources':
        addBot(`${L.youAsked(L.resourcesTitle)}<br><br>
            <a href="https://bycell.co/ddmua" target="_blank">Additional resources</a><br>
            <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank">Full TASK services</a>`, L.resourcesTitle);
        return;

      case 'greeting':
        addBot(L.hello + '<br><br>' + L.quick);
        return;

      case 'thanks':
        addBot('üòä You‚Äôre welcome!');
        return;

      default:
        // Suggest the most likely next steps based on keywords (jobs vs work vs legal etc.)
        const fallback = `
          ${L.hello}<br><br>
          ${L.quick}`;
        addBot(fallback);
        return;
    }
  }

  // ==== SEND ================================================================
  let BUSY = false;

  function sendMessage(){
    if (BUSY) return;
    const text = (box.value || '').trim();
    if (!text) return;

    BUSY = true;
    addUser(text);
    box.value = '';
    statusEl.textContent = 'ü§ñ Thinking‚Ä¶';
    typingOn();

    // Language switch (explicit > detected)
    maybeSwitchLanguage(text);

    setTimeout(()=>{
      typingOff();
      route(text);
      statusEl.textContent = '‚úÖ Answered!';
      setTimeout(()=> statusEl.textContent = '‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!', 1300);
      BUSY = false;
      box.focus();
    }, 260);
  }

  // Wire UI
  send.addEventListener('click', sendMessage);
  box.addEventListener('keydown', e=>{ if (e.key==='Enter'){ e.preventDefault(); sendMessage(); } });

  // Initial greeting (always English on first load)
  if (!localStorage.getItem('taskLang')) currentLang = 'en';
  updateHint();
  addBot(`<div class="title-chip">Hello</div>${T().hello}<br><br>${T().quick}`);

  // Let the rail links open normally
  document.getElementById('top-rail').addEventListener('click', e=>{
    const a=e.target.closest('a'); if(!a) return;
  });
</script>
