<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TASK Assistant</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

<style>
  :root{
    /* Light theme */
    --bg: #f1f6fb;
    --panel: #ffffff;
    --border-strong: #ff911f;
    --border-soft: #cfe0ee;
    --ink: #1c2a33;
    --ink-soft:#566575;
    --brand-blue:#145078;
    --brand-blue-accent:#0085CA;
    --brand-teal:#33A7B5;
    --brand-orange:#ff911f;
    --brand-yellow:#ffc91f;
    --brand-green:#74ba58;

    --pill-bg:#fff;
    --pill-ink:#145078;

    --chip-bg: linear-gradient(135deg,var(--brand-orange),var(--brand-yellow));
    --chip-ink: #fff;

    --user-bubble: linear-gradient(135deg,var(--brand-orange),var(--brand-yellow));
    --user-ink:#fff;

    --bot-bdr: #0085CA;
    --bot-shadow: 0 3px 10px rgba(0,133,202,.12);

    --hint-bg: linear-gradient(135deg,rgba(116,186,88,.12),rgba(51,167,181,.12));
    --hint-bdr: var(--brand-green);

    --send-bg: linear-gradient(135deg,var(--brand-orange),var(--brand-yellow));
    --send-ink:#fff;

    --rail-bg:#f7fbff;

    --focus-ring: 0 0 0 3px rgba(255,145,31,.35);
  }

  /* Dark theme */
  [data-theme="dark"]{
    --bg:#0f2730;
    --panel:#0d1f26;
    --border-strong:#ffae57;
    --border-soft:#23404c;
    --ink:#e8f0f4;
    --ink-soft:#b9c6cf;
    --brand-blue:#bfe4ff;
    --brand-blue-accent:#7fd1ff;
    --brand-teal:#6ddae4;
    --brand-orange:#ffad53;
    --brand-yellow:#ffe07b;
    --brand-green:#90e589;

    --pill-bg:#122b35;
    --pill-ink:#e8f0f4;

    --chip-bg: linear-gradient(135deg,#ffad53,#ffe07b);
    --chip-ink:#14303c;

    --user-bubble: linear-gradient(135deg,#ffad53,#ffe07b);
    --user-ink:#14303c;

    --bot-bdr:#7fd1ff;
    --bot-shadow: 0 8px 20px rgba(0,0,0,.35);

    --hint-bg: linear-gradient(135deg,rgba(144,229,137,.15),rgba(109,218,228,.12));
    --hint-bdr:#90e589;

    --send-bg: linear-gradient(135deg,#ffad53,#ffe07b);
    --send-ink:#14303c;

    --rail-bg:#0c1a20;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(135deg,var(--brand-blue) 0%,var(--brand-teal) 100%);
    display:flex;align-items:center;justify-content:center;
    padding:14px;color:var(--ink);
  }
  .app{
    width:100%;max-width:430px;background:var(--panel);
    border:3px solid var(--border-strong);border-radius:18px;overflow:hidden;
    box-shadow:0 20px 40px rgba(20,80,120,.30); position:relative;
  }

  .header{
    display:flex;align-items:center;justify-content:center;gap:10px;
    border-bottom:2px solid var(--brand-blue);padding:10px 12px;background:var(--panel);
    position:relative;
  }
  .badge{
    display:inline-block;background:var(--brand-blue);color:#fff;
    padding:6px 12px;border-radius:999px;font:700 13px/1 "Nunito",sans-serif;
    letter-spacing:.2px;
  }
  .subline{color:var(--brand-orange);font:700 12px/1 "Nunito",sans-serif}

  .theme-btn{
    position:absolute;right:10px;top:10px;border:none;cursor:pointer;
    width:34px;height:34px;border-radius:50%;display:grid;place-items:center;
    background:var(--pill-bg);color:var(--pill-ink);box-shadow:0 1px 0 var(--border-soft) inset;
  }

  .rail{
    display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
    padding:10px 12px;background:var(--rail-bg);border-bottom:1px solid var(--border-soft)
  }
  .rail a{
    text-decoration:none;font-weight:600;color:var(--pill-ink);
    background:var(--pill-bg); border:1px solid var(--brand-orange);
    padding:7px 12px;border-radius:999px;display:inline-flex;gap:8px;align-items:center;
  }
  .rail a:hover{background:var(--brand-orange);color:#fff}

  .chat{height:400px;overflow:auto;background:var(--bg);padding:14px;scroll-behavior:smooth}

  .msg{margin:12px 0;padding:12px 14px;border-radius:16px;font-size:14px;line-height:1.45;animation:fade-in .16s ease}
  .msg.user{
    margin-left:22%; text-align:right; color:var(--user-ink);
    background:var(--user-bubble); border-radius:16px 16px 4px 16px;
    box-shadow:0 4px 12px rgba(255,145,31,.28)
  }
  .msg.bot{
    margin-right:22%; background:var(--panel); color:var(--ink);
    border:2px solid var(--bot-bdr); border-radius:16px 16px 16px 4px; box-shadow:var(--bot-shadow)
  }

  .title-chip{
    display:inline-block;margin-bottom:6px;
    padding:6px 10px;border-radius:10px;background:var(--chip-bg);
    color:var(--chip-ink); font-weight:700; font-family:"Nunito",sans-serif; font-size:13px;
  }

  .links a{color:var(--brand-blue-accent);text-decoration:none;font-weight:600}
  .links a:hover{text-decoration:underline}

  .pills{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
  .pill{
    display:inline-block;padding:6px 10px;border:1px solid var(--brand-orange);
    border-radius:999px;background:var(--pill-bg);color:var(--pill-ink);text-decoration:none;font-weight:600;
  }
  .pill:hover{background:var(--brand-orange);color:#fff}

  .typing{display:flex;align-items:center;gap:6px;background:transparent}
  .dot{width:6px;height:6px;border-radius:50%;background:var(--ink);animation:bob 1.2s infinite}
  .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}

  .footer{padding:12px;background:var(--rail-bg);border-top:2px solid var(--brand-blue-accent)}
  .hint{
    font-size:11px;color:var(--brand-blue);background:var(--hint-bg);
    border:2px solid var(--hint-bdr);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px
  }
  .inputrow{display:flex;gap:10px;align-items:center}
  input[type="text"]{
    flex:1;padding:14px 16px;border:2px solid var(--brand-blue-accent);border-radius:25px;font-size:14px;outline:none;background:var(--panel);color:var(--ink)
  }
  input[type="text"]::placeholder{color:var(--ink-soft)}
  input[type="text"]:focus{box-shadow:var(--focus-ring)}

  .send{width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:var(--send-ink);font-size:18px;background:var(--send-bg);box-shadow:0 6px 16px rgba(255,145,31,.28)}

  .status{margin-top:6px;text-align:center;font-size:10px;color:var(--ink-soft)}

  @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  @keyframes bob{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}

  @media (max-width:480px){
    .app{border-radius:16px}
  }
</style>
</head>
<body>
  <main class="app" id="app">
    <!-- header -->
    <div class="header">
      <div>
        <div class="badge">TASK Assistant</div>
        <div class="subline">Trenton Area Soup Kitchen</div>
      </div>
      <button class="theme-btn" id="themeBtn" title="Toggle theme" aria-label="Toggle theme">‚òÄÔ∏é</button>
    </div>

    <!-- top rail -->
    <nav class="rail" id="top-rail">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">üìç Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">üíº Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">üîî Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">üéì Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">üìÑ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">üé• Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">üß∞ Resources</a>
    </nav>

    <!-- chat -->
    <section class="chat" id="chat"></section>

    <!-- footer -->
    <footer class="footer">
      <div class="hint" id="langHint">I speak English, Espa√±ol & Krey√≤l</div>

      <div class="inputrow">
        <input id="box" type="text" placeholder="Type: training, jobs, hours, address, bus‚Ä¶" autocomplete="off" />
        <button id="send" class="send" aria-label="Send">‚û§</button>
      </div>

      <div class="status" id="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!</div>
    </footer>
  </main>
<script>
(function(){

  /* -------------------- State & helpers -------------------- */
  const chat = document.getElementById('chat');
  const box  = document.getElementById('box');
  const sendBtn = document.getElementById('send');
  const statusEl = document.getElementById('status');
  const langHint = document.getElementById('langHint');
  const themeBtn = document.getElementById('themeBtn');

  const state = {
    lang: 'en',           // default English
    busy: false,
    theme: localStorage.getItem('task_theme') || 'light'
  };
  if (state.theme === 'dark') {
    document.documentElement.setAttribute('data-theme','dark');
    themeBtn.textContent = 'üåô';
  }

  function setTheme(next){
    state.theme = next;
    localStorage.setItem('task_theme', next);
    document.documentElement.setAttribute('data-theme', next === 'dark' ? 'dark' : 'light');
    themeBtn.textContent = next === 'dark' ? 'üåô' : '‚òÄÔ∏é';
  }
  themeBtn.addEventListener('click', ()=>{
    setTheme(state.theme === 'dark' ? 'light' : 'dark');
  });

  function addUser(text){
    const el = document.createElement('div');
    el.className = 'msg user';
    el.textContent = text;
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  }
  function addBot(html, title){ // title optional; omitted on the very first message
    const el = document.createElement('div');
    el.className = 'msg bot';
    el.innerHTML = (title ? `<div class="title-chip">${title}</div>` : ``) + html;
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  }
  function typingOn(){
    const wrap = document.createElement('div');
    wrap.className = 'msg typing'; wrap.id = 'typing';
    wrap.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
    chat.appendChild(wrap); chat.scrollTop = chat.scrollHeight;
  }
  function typingOff(){ const t = document.getElementById('typing'); if (t) t.remove(); }

  /* -------------------- Language & text -------------------- */

  // Soft language detection: returns 'en', 'es', or 'ht'
  function detectLang(text){
    const t = text.toLowerCase();

    // explicit asks take priority
    if (/^english$|speak english|in english|back to english/.test(t)) return 'en';
    if (/^espa√±ol$|^espanol$|en espa√±ol|habla espa√±ol|en espanol/.test(t)) return 'es';
    if (/^krey[o√≤]l$|^creole$|an krey[o√≤]l|in creole/.test(t)) return 'ht';

    // quick heuristics
    const es = /(hola|necesito|trabajo|empleo|d[o√≥]nde|cu[a√°]ndo|hora|horas|direcci[o√≥]n|cita|servicios|comida|gracias|busco)/.test(t);
    const ht = /(bonjou|bonswa|mwen|bezwen|travay|kote|ede|manje|krey[o√≤]l|telef[o√≤]n|adr[e√®]s|randevou|m[e√®]si)/.test(t);
    if (es && !ht) return 'es';
    if (ht && !es) return 'ht';
    return state.lang; // keep current if unsure
  }

  // simple i18n
  const copy = {
    en: {
      hello: `Hello! Tell me <em>training</em>, <em>jobs</em>, <em>hours</em>, <em>address</em>, or <em>bus</em>.`,
      quick: `Quick links: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Training</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Jobs</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alerts</a>`,
      asked: s => `You asked about ${s}.`,
      appt: () =>
        `Call Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a>. During lunch (10:30 AM‚Äì1:00 PM).`,
      hours: () =>
        `Meals: Lunch Mon‚ÄìFri 10:30 AM‚Äì1:00 PM ‚Ä¢ Dinner Mon‚ÄìThu 3:30‚Äì5:00 PM.<br>Employment appointments are scheduled during lunch hours.`,
      location: () =>
        `72¬Ω Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Open Google Maps</a>`,
      transit: () =>
        `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">NJ Transit Trip Planner</a> ‚Ä¢ 1-973-275-5555<br>Destination: 72¬Ω Escher St, Trenton.`,
      jobs: () =>
        `<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Open positions</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Job alerts</a>`,
      training: () =>
        `‚Ä¢ Emilio Culinary Academy (10-week)<br>‚Ä¢ SORA Security Certification<br>‚Ä¢ Forklift Certification<br><br><a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Browse training & apply</a>`,
      resume: () =>
        `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Resume help & templates</a>`,
      interview: () =>
        `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Watch interview tips</a>`,
      resources: () =>
        `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Additional resources</a> ‚Ä¢ <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Full TASK services</a>`,
      greeting: `Hi there!`,
      thanks: `You're welcome!`,
      empathy: `I‚Äôm sorry this is frustrating. I‚Äôm here to help.`,
      human: () =>
        `If you‚Äôd like to speak with someone, call our Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a> (during lunch 10:30 AM‚Äì1:00 PM).`
    },
    es: {
      hello: `¬°Hola! Preg√∫ntame sobre <em>entrenamientos</em>, <em>empleos</em>, <em>horarios</em>, <em>direcci√≥n</em> o <em>autob√∫s</em>.`,
      quick: `Enlaces: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Entrenamientos</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Empleos</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas</a>`,
      asked: s => `Preguntas sobre ${s}.`,
      appt: () =>
        `Llama a la Especialista de Servicios Sociales al <a href="tel:609-337-1624">(609) 337-1624</a>. Durante el almuerzo (10:30 AM‚Äì1:00 PM).`,
      hours: () =>
        `Comidas: Almuerzo Lun‚ÄìVie 10:30 AM‚Äì1:00 PM ‚Ä¢ Cena Lun‚ÄìJue 3:30‚Äì5:00 PM.<br>Las citas de empleo se programan durante el almuerzo.`,
      location: () =>
        `72¬Ω Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Abrir Google Maps</a>`,
      transit: () =>
        `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planificador NJ Transit</a> ‚Ä¢ 1-973-275-5555<br>Destino: 72¬Ω Escher St, Trenton.`,
      jobs: () =>
        `<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Puestos disponibles</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas de empleo</a>`,
      training: () =>
        `‚Ä¢ Academia Culinaria Emilio (10 semanas)<br>‚Ä¢ Certificaci√≥n SORA (seguridad)<br>‚Ä¢ Certificaci√≥n de montacargas<br><br><a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Ver entrenamientos y aplicar</a>`,
      resume: () =>
        `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Ayuda con curr√≠culum</a>`,
      interview: () =>
        `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Ver consejos para entrevistas</a>`,
      resources: () =>
        `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Recursos adicionales</a> ‚Ä¢ <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Servicios de TASK</a>`,
      greeting: `¬°Hola!`,
      thanks: `¬°Con gusto!`,
      empathy: `Siento que esto te frustre. Estoy aqu√≠ para ayudarte.`,
      human: () =>
        `Si prefieres hablar con alguien, llama a <a href="tel:609-337-1624">(609) 337-1624</a> (durante el almuerzo 10:30 AM‚Äì1:00 PM).`
    },
    ht: {
      hello: `Bonjou! Di m <em>f√≤masyon</em>, <em>travay</em>, <em>l√®</em>, <em>adr√®s</em>, oswa <em>otobis</em>.`,
      quick: `Lyen rapid: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">F√≤masyon</a> ‚Ä¢ <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Travay</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Al√®t</a>`,
      asked: s => `Ou mande sou ${s}.`,
      appt: () =>
        `Rele Espesyalis S√®vis Sosyal la nan <a href="tel:609-337-1624">(609) 337-1624</a>. Pandan manje midi (10:30 AM‚Äì1:00 PM).`,
      hours: () =>
        `Manje: Maten/Lendi‚ÄìVandredi 10:30 AM‚Äì1:00 PM ‚Ä¢ Asw√®/Lendi‚ÄìJedi 3:30‚Äì5:00 PM.<br>Randevou travay f√®t pandan l√® manje midi yo.`,
      location: () =>
        `72¬Ω Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Louvri Google Maps</a>`,
      transit: () =>
        `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planifikat√® NJ Transit</a> ‚Ä¢ 1-973-275-5555<br>Destinasyon: 72¬Ω Escher St, Trenton.`,
      jobs: () =>
        `<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">P√≤s ki disponib</a> ‚Ä¢ <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Al√®t travay</a>`,
      training: () =>
        `‚Ä¢ Akademi Culin√® Emilio (10 sem√®n)<br>‚Ä¢ S√®tifikasyon SORA<br>‚Ä¢ S√®tifikasyon forklift<br><br><a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Gade f√≤masyon yo & aplike</a>`,
      resume: () =>
        `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">√àd ak CV</a>`,
      interview: () =>
        `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Gade kons√®y ent√®vyou</a>`,
      resources: () =>
        `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Resous adisyon√®l</a> ‚Ä¢ <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Tout s√®vis TASK</a>`,
      greeting: `Bonjou!`,
      thanks: `Padon. M√®si!`,
      empathy: `Mwen regr√®t sa fache w. Mwen la pou ede.`,
      human: () =>
        `Si ou vle pale ak yon moun, rele <a href="tel:609-337-1624">(609) 337-1624</a> (pandan manje midi 10:30 AM‚Äì1:00 PM).`
    }
  };
  const T = () => copy[state.lang];

  /* -------------------- Intent classification -------------------- */
  function classifyIntent(text){
    const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');

    const bag = {
      training: /(training|trainings|program|programs|class|classes|course|courses|certification|culinary|emilio|academy|sora|forklift|apprenticeship|formaci[o√≥]n|entrenamiento|clase|curso|f√≤masyon|kout|kou)\b/,
      jobs: /(job|jobs|work|employment|hiring|hire|opening|openings|apply|position|positions|empleo|empleos|trabajo|travay|op√≤tinite)/,
      alerts: /(alert|alerts|notify|notification|subscribe|updates|alertas|al√®t)/,
      resume: /(resume|cv|cover\s*letter|curriculum|curr[i√≠]culum|cv|rezime)/,
      interview: /(interview|mock\s*interview|practice\s*interview|entrevista|ent√®vyou|ent√®vyou)/,
      appointment: /(appointment|schedule|book|meeting|register|sign\s*up|rsvp|cita|programar|randevou)/,
      hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|horas|almuerzo|cena|manje)/,
      location: /(where|address|location|directions|map|parking|d[o√≥]nde|direcci[o√≥]n|ubicaci[o√≥]n|kote|adr[e√®]s)/,
      transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner|autob[u√∫]s|otobis|transp[o√≤])/,
      computer: /(computer|internet|wifi|lab|email|application\s*online|laboratorio|√≤dinat√®)/,
      resources: /(resource|resources|assistance|support\s*services|services\s*list|recursos|s√®vis|ede)/,
      thanks: /(thanks|thank you|gracias|mesi|m√®si)/,
      greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
      frustration: /(this (is )?(not )?working|annoying|useless|stupid|dumb|wtf|why|help now|i need (a )?human|talk to (a )?person|someone please)/,
      human: /(human|person|live agent|staff|someone|operator|front desk|call someone)/
    };
    for (const [k, rx] of Object.entries(bag)) if (rx.test(t)) return k;
    return 'default';
  }

  /* -------------------- Router -------------------- */
  function route(text){
    // Maybe switch language
    const detected = detectLang(text);
    if (detected !== state.lang) {
      state.lang = detected;
      langHint.textContent = (state.lang==='en')
        ? 'I speak English, Espa√±ol & Krey√≤l'
        : (state.lang==='es')
          ? 'Hablo ingl√©s y espa√±ol (y Krey√≤l)'
          : 'M pale Angle, Pany√≤l & Krey√≤l';
    }

    const intent = classifyIntent(text);

    const R = {
      training: () => ({
        title: (state.lang==='es'?'Entrenamientos':state.lang==='ht'?'F√≤masyon':'Training'),
        html: `<div class="links">${T().asked(state.lang==='es'?'entrenamientos':state.lang==='ht'?'f√≤masyon':'training')}</div><br>${T().training()}`
      }),
      jobs: () => ({
        title: (state.lang==='es'?'Empleos':state.lang==='ht'?'Travay':'Jobs'),
        html: `<div class="links">${T().asked(state.lang==='es'?'empleos':state.lang==='ht'?'travay':'jobs')}</div><br>${T().jobs()}`
      }),
      alerts: () => ({
        title: (state.lang==='es'?'Alertas':state.lang==='ht'?'Al√®t':'Alerts'),
        html: `<div class="links">${T().asked(state.lang==='es'?'alertas':state.lang==='ht'?'al√®t':'alerts')}</div><br>${T().jobs()}`
      }),
      resume: () => ({
        title: (state.lang==='es'?'Curr√≠culum':state.lang==='ht'?'Rezime':'Resume'),
        html: `<div class="links">${T().asked(state.lang==='es'?'curr√≠culum':state.lang==='ht'?'rezime':'resume')}</div><br>${T().resume()}`
      }),
      interview: () => ({
        title: (state.lang==='es'?'Entrevista':state.lang==='ht'?'Ent√®vyou':'Interview'),
        html: `<div class="links">${T().asked(state.lang==='es'?'entrevista':'ent√®vyou')}</div><br>${T().interview()}`
      }),
      appointment: () => ({
        title: (state.lang==='es'?'Cita':state.lang==='ht'?'Randevou':'Appointment'),
        html: `<div class="links">${T().asked(state.lang==='es'?'una cita':state.lang==='ht'?'yon randevou':'an appointment')}</div><br>${T().appt()}`
      }),
      hours: () => ({
        title: (state.lang==='es'?'Horarios':state.lang==='ht'?'Or√®':'Hours'),
        html: `<div class="links">${T().asked(state.lang==='es'?'horarios':state.lang==='ht'?'or√®':'hours')}</div><br>${T().hours()}`
      }),
      location: () => ({
        title: (state.lang==='es'?'Ubicaci√≥n':state.lang==='ht'?'Kote':'Location'),
        html: `<div class="links">${T().asked(state.lang==='es'?'la ubicaci√≥n':state.lang==='ht'?'kote a':'our location')}</div><br>${T().location()}`
      }),
      transit: () => ({
        title: (state.lang==='es'?'Transporte':state.lang==='ht'?'Transp√≤':'Transit'),
        html: `<div class="links">${T().asked(state.lang==='es'?'transporte':state.lang==='ht'?'transp√≤':'transit')}</div><br>${T().transit()}`
      }),
      computer: () => ({
        title: (state.lang==='es'?'Computadoras':state.lang==='ht'?'√ídinat√®':'Computer Lab'),
        html: `<div class="links">${T().asked(state.lang==='es'?'computadoras':state.lang==='ht'?'√≤dinat√®':'the computer lab')}</div><br>Open during meal hours. Free internet & job applications.`
      }),
      resources: () => ({
        title: (state.lang==='es'?'Recursos':state.lang==='ht'?'Resous':'Resources'),
        html: `<div class="links">${T().asked(state.lang==='es'?'recursos':state.lang==='ht'?'resous':'resources')}</div><br>${T().resources()}`
      }),
      thanks: () => ({ title: '', html: T().thanks }),
      frustration: () => ({
        title: (state.lang==='es'?'Ayuda':'Help'),
        html: `${T().empathy}<br><br>${T().human()}`
      }),
      human: () => ({
        title: (state.lang==='es'?'Hablar con alguien':state.lang==='ht'?'Pale ak yon moun':'Talk to a person'),
        html: T().human()
      }),
      greeting: () => ({
        title: '', html: `${T().hello}<br><br>${T().quick}`
      }),
      default: () => ({
        title: '', html:
          `${T().hello}<br><br>${T().quick}`
      })
    };

    const out = (R[intent] || R.default)();
    return out;
  }

  /* -------------------- Send logic -------------------- */
  function sendMessage(){
    if (state.busy) return;
    const text = (box.value || '').trim();
    if (!text) return;

    state.busy = true;
    addUser(text);
    box.value = '';
    statusEl.textContent = (state.lang==='es'?'Pensando‚Ä¶':state.lang==='ht'?'Ap panse‚Ä¶':'Thinking‚Ä¶');
    typingOn();

    setTimeout(()=>{
      typingOff();
      const {html, title} = route(text);
      addBot(html, title);    // no gold chip on initial greet; otherwise title shows
      statusEl.textContent = (state.lang==='es'?'¬°Listo!':state.lang==='ht'?'F√®!':'Answered!');
      setTimeout(()=> statusEl.textContent = '‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!', 1300);
      state.busy = false;
      box.focus();
    }, 300);
  }

  sendBtn.addEventListener('click', sendMessage);
  box.addEventListener('keydown', e => { if (e.key === 'Enter'){ e.preventDefault(); sendMessage(); } });

  // Top rail: open links only
  document.getElementById('top-rail').addEventListener('click', e=>{
    const a = e.target.closest('a'); if (!a) return;
  });

  /* -------------------- First message (NO gold chip) -------------------- */
  addBot(`${T().hello}<br><br>${T().quick}`);  // no title chip here

})();
</script>
</body>
</html>