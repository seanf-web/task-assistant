<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TASK Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      /* LIGHT THEME */
      --bg-grad-a:#145078; --bg-grad-b:#33A7B5;
      --panel:#ffffff;
      --ink:#142933;
      --muted:#6b7882;
      --ring:#0085CA;
      --accent:#ff911f; --accent-2:#ffc91f;
      --rail:#f6fbff;
      --chip:#145078;
      --chip-ink:#fff;
      --hint-a:rgba(116,186,88,.12); --hint-b:rgba(51,167,181,.12);
      --ok:#65b851;

      --bubble-ghost:#eef5fa;
      --typing:#e8edf2;
      --shadow: 0 20px 40px rgba(20,80,120,.28);
      --border-soft: #e6edf4;

      --transition: 170ms ease;
    }

    [data-theme="dark"]{
      /* DARK THEME (higher contrast, cleaner) */
      --bg-grad-a:#0f1e27; --bg-grad-b:#103443;
      --panel:#0d212b;
      --ink:#e7f3f9;
      --muted:#a8bfca;
      --ring:#3bb7cc;
      --accent:#ffa24a; --accent-2:#ffd766;
      --rail:#0b1a22;
      --chip:#1f91d1;
      --chip-ink:#08161c;
      --hint-a:rgba(121,215,110,.15); --hint-b:rgba(59,183,204,.15);
      --ok:#79d76e;

      --bubble-ghost:#142a35;
      --typing:#183341;
      --shadow: 0 16px 28px rgba(0,0,0,.55);
      --border-soft: #163341;

      --transition: 170ms ease;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg-grad-a) 0%,var(--bg-grad-b) 100%);
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;
      color:var(--ink);
    }

    .app{
      position:relative;
      width:100%;max-width:420px;background:var(--panel);
      border:3px solid var(--accent);border-radius:18px;overflow:hidden;
      box-shadow:var(--shadow);
      transition: background-color var(--transition), color var(--transition), border-color var(--transition);
    }

    .header{
      position:relative;text-align:center;background:var(--panel);
      border-bottom:2px solid var(--chip);padding:12px 52px 12px 12px;
      transition: border-color var(--transition);
    }
    .badge{
      display:inline-block;background:var(--chip);color:var(--chip-ink);
      padding:6px 12px;border-radius:999px;font:700 13px/1 "Nunito",sans-serif;letter-spacing:.2px;
    }
    .subline{
      margin-top:6px;color:var(--accent);font:700 12px/1 "Nunito",sans-serif;
    }
    .theme-toggle{
      position:absolute;right:10px;top:10px;width:36px;height:36px;border-radius:50%;
      border:2px solid var(--accent);background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:#082228;font-weight:800;cursor:pointer;display:grid;place-items:center;
      transition: transform var(--transition);
    }
    .theme-toggle:hover{ transform: scale(1.06); }

    .rail{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
      padding:10px 12px;background:var(--rail);border-bottom:1px solid var(--border-soft);
      transition: background-color var(--transition), border-color var(--transition);
    }
    .rail a{
      font-weight:600;text-decoration:none;color:var(--ink);
      border:1px solid var(--accent);background:transparent;border-radius:999px;
      padding:6px 10px;font-size:12px;transition: all var(--transition);
    }
    .rail a:hover{background:var(--accent);color:#000}

    .chat{
      height:360px;overflow:auto;background:var(--bubble-ghost);
      padding:14px;scroll-behavior:smooth;transition: background-color var(--transition);
    }

    .msg{margin:12px 0;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.45;animation:fade-in .16s ease}
    .user{
      margin-left:20%;text-align:right;color:#1c1a00;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));border-radius:16px 16px 4px 16px;
      box-shadow:0 4px 12px rgba(255,145,31,.28);
    }
    .bot{
      margin-right:20%;background:var(--panel);border:2px solid var(--ring);
      color:var(--ink);border-radius:16px 16px 16px 4px;box-shadow:0 3px 10px rgba(0,133,202,.12);
      transition: background-color var(--transition), border-color var(--transition), color var(--transition);
    }
    .typing{
      display:flex;align-items:center;gap:6px;background:var(--typing);
      color:#31485a;border:0;transition: background-color var(--transition), color var(--transition);
    }
    [data-theme="dark"] .typing{color:#bcd0da}

    .chips{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      display:inline-block;border:1px solid var(--accent);border-radius:999px;
      padding:6px 10px;font-size:12px;text-decoration:none;color:var(--ink);
      background:transparent;transition: all var(--transition);
    }
    .chip:hover{background:var(--accent);color:#000}

    .footer{padding:12px;background:var(--panel);border-top:2px solid var(--ring);transition: background-color var(--transition)}
    .hint{
      font-size:11px;color:var(--ink);
      background:linear-gradient(135deg,var(--hint-a),var(--hint-b));
      border:2px solid var(--ok);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px
    }
    .inputrow{display:flex;gap:10px;align-items:center}
    input[type="text"]{
      flex:1;padding:14px 16px;border:2px solid var(--ring);border-radius:25px;font-size:13px;outline:none;background:var(--panel);
      color:var(--ink);transition: border-color var(--transition), background-color var(--transition), color var(--transition);
    }
    input[type="text"]::placeholder{color:var(--muted)}
    input[type="text"]:focus{border-color:var(--accent)}

    button.send{
      width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:#082228;font-size:18px;font-weight:800;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 4px 15px rgba(255,145,31,.28);
      transition: transform var(--transition);
    }
    button.send:hover{ transform: scale(1.05) }

    .status{margin-top:6px;text-align:center;font-size:10px;color:var(--muted)}

    .section-pill{
      display:inline-block;margin:8px 0 2px;padding:10px 16px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b0a00;font-weight:700;font-family:"Nunito",sans-serif;
      box-shadow:0 6px 16px rgba(255,145,31,.25);
    }

    @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}
    .dot{width:6px;height:6px;border-radius:50%;background:currentColor;animation:bob 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}

    @media (max-width:480px){ .app{border-radius:16px} }
  </style>
</head>
<body>
  <main class="app" id="app" data-theme="light" role="application" aria-label="TASK Assistant">
    <header class="header">
      <div class="badge" aria-label="Assistant name">TASK Assistant</div>
      <div class="subline" aria-label="Organization">Trenton Area Soup Kitchen</div>
      <button class="theme-toggle" id="themeBtn" title="Toggle dark / light" aria-label="Toggle theme">‚òº</button>
    </header>

    <!-- Top rail (open links; no chat injection) -->
    <nav class="rail" id="top-rail" aria-label="Quick links">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">üìç Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">üíº Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">üîî Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">üéì Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">üìÑ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">üé• Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">üß∞ Resources</a>
    </nav>

    <section class="chat" id="chat" aria-live="polite"></section>

    <footer class="footer">
      <div class="hint" id="lang-hint">I speak English, Espa√±ol & Krey√≤l</div>
      <div class="inputrow">
        <input id="box" type="text" placeholder="Type: training, jobs, hours, address, bus‚Ä¶" autocomplete="off" aria-label="Type your message"/>
        <button class="send" id="send" aria-label="Send message">‚û§</button>
      </div>
      <div class="status" id="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!</div>
    </footer>
  </main>
  <script>
    // THEME
    const app = document.getElementById('app');
    const themeBtn = document.getElementById('themeBtn');
    // start from system preference
    const sysDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    app.dataset.theme = sysDark ? 'dark' : 'light';
    themeBtn.textContent = app.dataset.theme === 'dark' ? '‚òæ' : '‚òº';
    themeBtn.addEventListener('click', ()=>{
      app.dataset.theme = app.dataset.theme === 'dark' ? 'light' : 'dark';
      themeBtn.textContent = app.dataset.theme === 'dark' ? '‚òæ' : '‚òº';
    });

    // DOM
    const chat = document.getElementById('chat');
    const box  = document.getElementById('box');
    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');

    // State
    let BUSY = false;
    let currentLang = 'en'; // always start English

    // Initial greeting (English by default)
    addBot(sectionTitle('Hello'));
    addBot(`Hello! Tell me <em>training</em>, <em>jobs</em>, <em>hours</em>, <em>address</em>, or <em>bus</em>.<br><br>
            Quick links:
            <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Training</a> ‚Ä¢
            <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Jobs</a> ‚Ä¢
            <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alerts</a>`);

    // UTIL UI
    function addUser(text){
      const el = document.createElement('div');
      el.className = 'msg user';
      el.textContent = text;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBot(html){
      const el = document.createElement('div');
      el.className = 'msg bot';
      el.innerHTML = html;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function sectionTitle(txt){
      return `<div class="section-pill" role="heading" aria-level="2">${txt}</div>`;
    }
    function typingOn(){
      const wrap = document.createElement('div');
      wrap.className = 'msg typing';
      wrap.id = 'typing';
      wrap.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      chat.appendChild(wrap); chat.scrollTop = chat.scrollHeight;
    }
    function typingOff(){
      const t = document.getElementById('typing'); if (t) t.remove();
    }

    // LANGUAGE DETECTION (bidirectional ‚Äì switches back to English naturally)
    // Heuristic: score words by language; also accept explicit commands.
    function detectLang(input){
      const t = input.toLowerCase().trim();

      // Explicit commands first
      if (/\b(in english|english please|use english)\b/.test(t)) return 'en';
      if (/\b(en espa√±ol|espa√±ol|habla espa√±ol|hablar espa√±ol)\b/.test(t)) return 'es';
      if (/\b(krey[o√≤]l|an krey[o√≤]l|pale krey[o√≤]l|kreyol)\b/.test(t)) return 'ht';

      const tokens = t.split(/\s+/g);

      const bag = {
        en: ['training','trainings','class','classes','course','courses','job','jobs','work','resume','interview','tips','hours','when','open','close','where','address','bus','transit','appointment','schedule','help','legal','lawyer','court'],
        es: ['entrenamiento','entrenamientos','curso','cursos','empleo','empleos','trabajo','curr√≠culum','curriculum','entrevista','horas','cuando','abre','cierra','donde','direcci√≥n','autob√∫s','cita','ayuda','legal','abogado','corte','alertas','disponibles'],
        ht: ['f√≤masyon','kou','kouyo','travay','travayyo','cv','ent√®vyou','l√®','kil√®','louvri','f√®men','kote','adr√®s','otobis','randevou','ede','legal','avoka','tribinal','al√®t']
      };

      const score = {en:0, es:0, ht:0};
      for (const w of tokens){
        if (bag.en.includes(w)) score.en++;
        if (bag.es.includes(w)) score.es++;
        if (bag.ht.includes(w)) score.ht++;
        // language punctuation/diacritics hints
        if (/[¬ø¬°√°√©√≠√≥√∫√±]/.test(w)) score.es+=0.5;
        if (/[√®√≤√≤ÃÄ·ª≥]/i.test(w)) score.ht+=0.5;
      }

      // pick max if clearly higher
      const arr = Object.entries(score).sort((a,b)=>b[1]-a[1]);
      const [langCandidate, best] = arr[0];
      const second = arr[1][1];

      // Threshold: if best beats second by >=1, use it
      if (best - second >= 1){
        return langCandidate;
      }
      // Otherwise, keep current (minimize flicker)
      return currentLang;
    }

    // INTENT CLASSIFIER (keywords + synonyms)
    function classifyIntent(text){
      const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');
      const rx = {
        trainings: /(training|trainings|program|programs|class|classes|course|courses|certification|culinary|emilio|academy|sora|forklift|apprenticeship|entrenamiento|entrenamientos|curso|cursos|f√≤masyon|kou)\b/,
        jobs: /(job|jobs|work|employment|hiring|hire|opening|openings|apply|application|position|positions|empleo|empleos|trabajo|travay)\b/,
        alerts: /(alert|alerts|notify|notification|subscribe|updates|alertas|al√®t)\b/,
        resume: /(resume|curriculum|curr√≠culum|cv|cover\s*letter|curriculum vitae)\b/,
        interview: /(interview|interview\s*tips|mock\s*interview|practice\s*interview|entrevista|kons√®y\s*ent√®vyou)\b/,
        appointments: /(appointment|schedule|book|meeting|cita|programar|randevou)\b/,
        hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|horario|almuerzo|cena|manje)\b/,
        location: /(where|address|location|directions|map|parking|d[o√≥]nde|direcci[o√≥]n|ubicaci[o√≥]n|kote|adr[e√®]s)\b/,
        transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner|autob[u√∫]s|otobis)\b/,
        computer_lab: /(computer|internet|wifi|lab|email|application\s*online)\b/,
        resources: /(resource|resources|assistance|support\s*services|services\s*list|legal|lawyer|court|expungement|documents|housing)\b/,
        greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
        thanks: /(thanks|thank you|gracias|mesi)\b/
      };
      for (const [k, r] of Object.entries(rx)){ if (r.test(t)) return k; }
      return 'default';
    }

    // TEMPLATES (varied phrasing per intent, per language)
    function replyText(intent, lang){
      const L = tr(lang);
      const callLine = `${L.call} ${L.sss} ${L.phone}. ${L.during}.`;

      const T = {
        trainings: [
          `<strong>üéì ${L.youAsked} ${L.training}.</strong><br><br>
           ‚Ä¢ Emilio Culinary Academy (10-week)<br>
           ‚Ä¢ SORA Security Certification<br>
           ‚Ä¢ Forklift Certification<br><br>
           <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">${L.browseTraining}</a><div class="chips">
           <a class="chip" href="https://bycell.co/ddmtn" target="_blank" rel="noopener">${L.training}</a>
           <a class="chip" href="https://bycell.co/ddmtq" target="_blank" rel="noopener">${L.jobs}</a></div><br>${callLine}`
        ],
        jobs: [
          `<strong>üíº ${L.youAsked} ${L.jobs}.</strong><br><br>
           <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">${L.openPositions}</a><br>
           <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">${L.getAlerts}</a>
           <div class="chips"><a class="chip" href="https://bycell.co/ddmtq" target="_blank" rel="noopener">${L.openJobsChip}</a>
           <a class="chip" href="https://bycell.co/ddmui" target="_blank" rel="noopener">${L.resume}</a></div><br>${callLine}`
        ],
        alerts: [
          `<strong>üîî ${L.youAsked} ${L.alerts}.</strong><br><br>
           <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">${L.subscribeAlerts}</a>`
        ],
        resume: [
          `<strong>üìÑ ${L.youAsked} ${L.resumeHelp}.</strong><br><br>
           <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">${L.resumeHelpLink}</a>
           <div class="chips"><a class="chip" href="https://bycell.co/ddmui" target="_blank" rel="noopener">${L.resumeTemplates}</a>
           <a class="chip" href="https://bycell.co/ddmtn" target="_blank" rel="noopener">${L.training}</a></div><br>${callLine}`
        ],
        interview: [
          `<strong>üé• ${L.youAsked} ${L.interviewTips}.</strong><br><br>
           <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">${L.watchTips}</a>`
        ],
        appointments: [
          `<strong>üìÖ ${L.youAsked} ${L.appointment}.</strong><br><br>${callLine}
           <div class="chips"><a class="chip" href="tel:609-337-1624">${L.callNow}</a>
           <a class="chip" href="https://bycell.co/ddmtn" target="_blank" rel="noopener">${L.training}</a></div>`
        ],
        hours: [
          `<strong>üïí ${L.youAsked} ${L.hours}.</strong><br><br>
           ${L.mealHours}<br>${L.apptDuring}`
        ],
        location: [
          `<strong>üìç ${L.youAsked} ${L.location}.</strong><br><br>
           72¬Ω Escher St, Trenton, NJ 08609<br>
           <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">${L.openMaps}</a>
           <div class="chips"><a class="chip" href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">${L.busToTask}</a></div><br>${callLine}`
        ],
        transit: [
          `<strong>üöå ${L.youAsked} ${L.transit}.</strong><br><br>
           <a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">${L.njTransit}</a> ‚Ä¢ 1-973-275-5555<br>
           ${L.destination}`
        ],
        computer_lab: [
          `<strong>üíª ${L.youAsked} ${L.computerLab}.</strong><br><br>${L.labHours}`
        ],
        resources: [
          `<strong>üß∞ ${L.youAsked} ${L.resources}.</strong><br><br>
           <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">${L.moreResources}</a><br>
           <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">${L.fullServices}</a>`
        ],
        greeting: [
          `üëã ${L.greet} ${L.quickList}`
        ],
        thanks: [ L.youAreWelcome ],
        default: [
          `${L.tryThese}<br><br>
           <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">${L.training}</a> ‚Ä¢
           <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">${L.jobs}</a>`
        ]
      };

      const arr = T[intent] || T.default;
      return arr[Math.floor(Math.random()*arr.length)];
    }

    // TRANSLATIONS
    function tr(lang){
      if (lang==='es') return {
        call:'Llame', sss:'al Especialista de Servicios Sociales al', phone:'<a href="tel:609-337-1624">(609) 337-1624</a>',
        during:'Durante el almuerzo (10:30 AM‚Äì1:00 PM)',
        youAsked:'Preguntaste sobre', greet:'¬°Hola! Dime', quickList:'entrenamientos, empleos, horas, direcci√≥n, o autob√∫s.',
        training:'Entrenamiento', jobs:'Empleos', alerts:'Alertas', hours:'horarios', location:'la ubicaci√≥n', transit:'el transporte',
        appointment:'una cita', resume:'Curr√≠culum', resumeHelp:'ayuda con curr√≠culum', interviewTips:'consejos para entrevistas',
        computerLab:'el laboratorio de computadoras', resources:'recursos',
        browseTraining:'Ver entrenamientos y aplicar',
        openPositions:'Puestos disponibles (Condado de Mercer)',
        getAlerts:'Recibir alertas de empleo',
        resumeHelpLink:'Ayuda y plantillas de curr√≠culum',
        resumeTemplates:'Plantillas de curr√≠culum',
        openJobsChip:'Empleos',
        callNow:'Llamar ahora',
        mealHours:'Comidas: Almuerzo Lun‚ÄìVie 10:30a‚Äì1:00p ‚Ä¢ Cena Lun‚ÄìJue 3:30‚Äì5:00p',
        apptDuring:'Las citas de empleo se programan durante el almuerzo.',
        openMaps:'Abrir Google Maps', busToTask:'Bus a TASK',
        njTransit:'Planificador de viajes NJ Transit',
        destination:'Destino: 72¬Ω Escher St, Trenton',
        computer:'computadora', labHours:'Abierto durante el horario de comidas. Internet gratis y solicitudes de empleo.',
        moreResources:'Recursos adicionales', fullServices:'Servicios completos de TASK',
        watchTips:'Ver consejos r√°pidos',
        tryThese:'Intentemos algo simple. Prueba ‚Äúentrenamiento‚Äù, ‚Äúempleos‚Äù, ‚Äúcita‚Äù, ‚Äúhorarios‚Äù, ‚Äúdirecci√≥n‚Äù o ‚Äúautob√∫s‚Äù.',
        youAreWelcome:'üòä ¬°De nada!'
      };
      if (lang==='ht') return {
        call:'Rele', sss:'Espesyalis S√®vis Sosyal la nan', phone:'<a href="tel:609-337-1624">(609) 337-1624</a>',
        during:'Pandan manje midi (10:30 AM‚Äì1:00 PM)',
        youAsked:'Ou te mande sou', greet:'Bonjou! Di m', quickList:'f√≤masyon, travay, l√®, adr√®s, oswa otobis.',
        training:'F√≤masyon', jobs:'Travay', alerts:'Al√®t', hours:'l√® yo', location:'kote a', transit:'transp√≤',
        appointment:'yon randevou', resume:'CV', resumeHelp:'ede ak CV', interviewTips:'kons√®y ent√®vyou',
        computerLab:'laboratwa √≤dinat√® a', resources:'resous',
        browseTraining:'Gade f√≤masyon & aplike',
        openPositions:'P√≤s ki ouv√® (Konble Mercer)',
        getAlerts:'Resevwa al√®t travay',
        resumeHelpLink:'Ede & mod√®l CV',
        resumeTemplates:'Mod√®l CV',
        openJobsChip:'Travay',
        callNow:'Rele kounye a',
        mealHours:'Manje: Manje midi Len‚ÄìVan 10:30a‚Äì1:00p ‚Ä¢ Manje asw√® Len‚ÄìJed 3:30‚Äì5:00p',
        apptDuring:'Yo pwograme randevou travay pandan manje midi.',
        openMaps:'Louvri Google Maps', busToTask:'Otobis pou TASK',
        njTransit:'Planifye vwayaj ak NJ Transit',
        destination:'Destinasyon: 72¬Ω Escher St, Trenton',
        computer:'√≤dinat√®', labHours:'Louvri pandan l√® manje yo. Ent√®n√®t gratis & aplikasyon travay.',
        moreResources:'Resous adisyon√®l', fullServices:'S√®vis konpl√® TASK',
        watchTips:'Gade kons√®y rapid yo',
        tryThese:'Ann f√® li senp. Eseye ‚Äúf√≤masyon‚Äù, ‚Äútravay‚Äù, ‚Äúrandevou‚Äù, ‚Äúl√®‚Äù, ‚Äúadr√®s‚Äù oswa ‚Äúotobis‚Äù.',
        youAreWelcome:'üòä Pa gen pwobl√®m!'
      };
      // English default
      return {
        call:'Call', sss:'the Social Services Specialist at', phone:'<a href="tel:609-337-1624">(609) 337-1624</a>',
        during:'During lunch (10:30 AM‚Äì1:00 PM)',
        youAsked:'You asked about', greet:'Hello! Tell me', quickList:'training, jobs, hours, address, or bus.',
        training:'Training', jobs:'Jobs', alerts:'Alerts', hours:'hours', location:'our location', transit:'transit',
        appointment:'an appointment', resume:'Resume', resumeHelp:'resume help', interviewTips:'interview tips',
        computerLab:'the computer lab', resources:'resources',
        browseTraining:'Browse training & apply',
        openPositions:'Open positions (Mercer County)',
        getAlerts:'Get job alerts',
        resumeHelpLink:'Resume help & templates',
        resumeTemplates:'Resume templates',
        openJobsChip:'Open Jobs',
        callNow:'Call now',
        mealHours:'Meals: Lunch Mon‚ÄìFri 10:30a‚Äì1:00p ‚Ä¢ Dinner Mon‚ÄìThu 3:30‚Äì5:00p',
        apptDuring:'Employment appointments are scheduled during lunch.',
        openMaps:'Open Google Maps', busToTask:'Bus to TASK',
        njTransit:'NJ Transit Trip Planner',
        destination:'Destination: 72¬Ω Escher St, Trenton.',
        computer:'computer', labHours:'Open during meal hours. Free internet & job applications.',
        moreResources:'Additional resources', fullServices:'Full TASK services',
        watchTips:'Watch quick tips',
        tryThese:'I‚Äôll keep it simple. Try ‚Äútraining‚Äù, ‚Äújobs‚Äù, ‚Äúappointment‚Äù, ‚Äúhours‚Äù, ‚Äúaddress‚Äù, or ‚Äúbus‚Äù.',
        youAreWelcome:'üòä You‚Äôre welcome!'
      };
    }

    // ROUTER
    function route(text){
      // Update language immediately (can switch back to English naturally)
      currentLang = detectLang(text);

      const intent = classifyIntent(text);
      const html = replyText(intent, currentLang);
      return html;
    }

    // SEND
    function sendMessage(){
      if (BUSY) return;
      const text = (box.value || '').trim();
      if (!text) return;

      BUSY = true;
      addUser(text);
      box.value = '';
      statusEl.textContent = 'ü§ñ Thinking‚Ä¶';
      typingOn();

      setTimeout(()=>{
        typingOff();
        addBot(route(text));
        statusEl.textContent = '‚úÖ Answered!';
        setTimeout(()=> statusEl.textContent = '‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!', 1200);
        BUSY = false;
        box.focus();
      }, 260);
    }

    // Wire events
    sendBtn.addEventListener('click', sendMessage);
    box.addEventListener('keydown', e=>{
      if (e.key === 'Enter'){ e.preventDefault(); sendMessage(); }
    });

    // Rail: allow links to open; no chat injection
    document.getElementById('top-rail').addEventListener('click', e=>{
      const a = e.target.closest('a'); if (!a) return;
    });
  </script>
</body>
</html>
