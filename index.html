<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TASK Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      /* Brand */
      --task-blue:#145078;
      --task-teal:#33A7B5;
      --task-orange:#ff911f;
      --task-yellow:#ffc91f;
      --task-green:#74ba58;
      --task-blue-accent:#0085CA;

      /* Light (default) */
      --bg0:#f0f4f8;
      --bg1:#ffffff;
      --surface:#f7fbff;
      --line:#e4ebf2;
      --text:#1a2736;
      --text-dim:#4c5a6b;
      --link:#0b63d1;

      --pill-bg:#fff;
      --pill-border:#ffb972;

      --send-grad: linear-gradient(135deg, var(--task-orange), var(--task-yellow));
      --shadow: 0 20px 40px rgba(20,80,120,.18);

      /* Optional watermark logo */
      --logo-url: '';
    }

    /* ChatGPT-ish dark mode (soft, low saturation) */
    :root[data-theme="dark"]{
      --bg0:#0f1420;
      --bg1:#121826;
      --surface:#1a2233;
      --line:#2a3447;
      --text:#e7ebf2;
      --text-dim:#b7c0cf;
      --link:#8ab4f8;

      --pill-bg:#151d2b;
      --pill-border:#2b3750;

      --send-grad: linear-gradient(135deg,#f1a341,#f6cf6d);
      --shadow: 0 10px 28px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,var(--task-blue) 0%,var(--task-teal) 100%);
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;
    }

    .app{
      position:relative;
      width:100%;max-width:420px;background:var(--bg1);
      border:3px solid var(--task-orange);border-radius:18px;overflow:hidden;
      box-shadow:var(--shadow);
    }

    /* optional watermark (off by default) */
    .app::before{
      content:"";
      position:absolute;inset:0;pointer-events:none;opacity:.06;
      background: radial-gradient(ellipse at center,#fff 0%,#fff 40%,transparent 60%) center/75% 75% no-repeat;
      mix-blend-mode:normal;
    }
    .app[data-logo="on"]::before{
      background: url(var(--logo-url)) center/68% no-repeat;
      opacity:.05;
    }

    .header{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;border-bottom:1px solid var(--line);background:var(--bg1);
    }
    .titlewrap{display:flex;flex-direction:column;gap:4px}
    .badge{
      display:inline-block;background:var(--task-blue);color:#fff;
      padding:6px 12px;border-radius:999px;font:700 13px/1 "Nunito",sans-serif;letter-spacing:.2px;
    }
    .subline{
      color:var(--task-orange);font:700 12px/1 "Nunito",sans-serif;
    }

    .toggle{
      border:1px solid var(--line);background:var(--surface);color:var(--text);
      width:34px;height:34px;border-radius:50%;display:grid;place-items:center;cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,.08);
    }

    .rail{
      display:flex;gap:12px;flex-wrap:wrap;justify-content:center;
      padding:10px 12px;background:var(--surface);border-bottom:1px solid var(--line);
    }
    .rail a{
      font-weight:600;text-decoration:none;color:var(--text);
      border:1px solid var(--pill-border);background:var(--pill-bg);border-radius:999px;
      padding:6px 10px;font-size:12px;
    }
    .rail a:hover{filter:brightness(.98)}

    .chat{height:360px;overflow:auto;background:var(--bg1);padding:14px;scroll-behavior:smooth}

    .msg{margin:12px 0;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.45;animation:fade-in .16s ease}
    .user{margin-left:20%;text-align:right;color:#fff;
      background:var(--send-grad);border-radius:16px 16px 4px 16px;
      box-shadow:0 4px 12px rgba(255,145,31,.22);
    }
    .bot{margin-right:20%;background:var(--surface);border:1px solid var(--line);
      color:var(--text);border-radius:16px 16px 16px 4px;box-shadow:0 3px 10px rgba(0,0,0,.06);
    }
    .typing{display:flex;align-items:center;gap:6px;background:#e8edf2;color:#4b5a69;border:1px solid var(--line)}
    body[data-theme="dark"] .typing{background:#182034;color:#9fb0c6}

    .dot{width:6px;height:6px;border-radius:50%;background:#4b5a69;animation:bob 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    body[data-theme="dark"] .dot{background:#a5b6d2}

    .footer{padding:12px;background:var(--bg1);border-top:1px solid var(--line)}
    .hint{font-size:11px;color:var(--task-blue);background:linear-gradient(135deg,rgba(116,186,88,.1),rgba(51,167,181,.1));
      border:2px solid var(--task-green);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px}
    body[data-theme="dark"] .hint{color:#cfe6ff;border-color:#6fcf97;background:rgba(111,207,151,.09)}

    .inputrow{display:flex;gap:10px;align-items:center}
    input[type="text"]{
      flex:1;padding:14px 16px;border:2px solid var(--input-border, var(--task-blue-accent));
      border-radius:25px;font-size:13px;outline:none;background:var(--input-bg, #fff);color:var(--text);
    }
    input[type="text"]:focus{border-color:var(--task-orange)}
    body:not([data-theme="dark"]) input[type="text"]{--input-border:var(--task-blue-accent)}
    body[data-theme="dark"] input[type="text"]{--input-border:#2e3a52;--input-bg:#121826}

    button.send{
      width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:18px;
      background:var(--send-grad);box-shadow:0 4px 14px rgba(255,145,31,.25);
    }
    .status{margin-top:6px;text-align:center;font-size:10px;color:var(--text-dim)}

    a{color:var(--link)}

    @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}

    @media (max-width:480px){ .app{border-radius:16px} }
  </style>
</head>
<body>
  <main class="app" id="app">
    <header class="header">
      <div class="titlewrap">
        <div class="badge">TASK Assistant</div>
        <div class="subline">Trenton Area Soup Kitchen</div>
      </div>
      <button id="modeToggle" class="toggle" title="Toggle theme">üåì</button>
    </header>

    <!-- Top rail pills (open links; no chat messages) -->
    <nav class="rail" id="top-rail">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">üìç Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">üíº Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">üîî Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">üéì Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">üìÑ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">üé• Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">üß∞ Resources</a>
    </nav>

    <section class="chat" id="chat"></section>

    <footer class="footer">
      <div class="hint" id="hint">I speak English, Espa√±ol &amp; Krey√≤l</div>
      <div class="inputrow">
        <input id="box" type="text" autocomplete="off"
          placeholder="Type keywords: training, jobs, hours, address, bus‚Ä¶"/>
        <button class="send" id="send" aria-label="Send">‚û§</button>
      </div>
      <div class="status" id="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!</div>
    </footer>
  </main>
  <script>
    // (Optional) watermark logo
    // const app = document.getElementById('app');
    // app.style.setProperty('--logo-url','https://yourcdn.com/task-logo.svg');
    // app.setAttribute('data-logo','on');

    const chat = document.getElementById('chat');
    const box  = document.getElementById('box');
    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');
    const hintEl = document.getElementById('hint');
    const modeToggle = document.getElementById('modeToggle');

    // ---- Theme -------------------------------------------------------------
    (function initTheme(){
      const saved = localStorage.getItem('task_theme');
      if (saved === 'dark') document.documentElement.setAttribute('data-theme','dark');
      drawThemeIcon();
    })();
    modeToggle.addEventListener('click', ()=>{
      const isDark = document.documentElement.getAttribute('data-theme')==='dark';
      document.documentElement.setAttribute('data-theme', isDark ? '' : 'dark');
      localStorage.setItem('task_theme', isDark ? 'light' : 'dark');
      drawThemeIcon();
    });
    function drawThemeIcon(){
      const isDark = document.documentElement.getAttribute('data-theme')==='dark';
      modeToggle.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
    }

    // ---- Chat helpers ------------------------------------------------------
    function addUser(text){
      const el = document.createElement('div');
      el.className = 'msg user';
      el.textContent = text;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBot(html){
      const el = document.createElement('div');
      el.className = 'msg bot';
      el.innerHTML = html;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function typingOn(){
      const wrap = document.createElement('div');
      wrap.className = 'msg typing';
      wrap.id = 'typing';
      wrap.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      chat.appendChild(wrap); chat.scrollTop = chat.scrollHeight;
    }
    function typingOff(){
      const t = document.getElementById('typing'); if (t) t.remove();
    }

    // ---- Language & intent -------------------------------------------------
    let lastLang = 'en'; // start in English

    function detectLang(t){
      t = t.toLowerCase();

      // explicit switching keywords
      if (/\b(english|ingl√©s|angle|anglais)\b/.test(t)) return 'en';
      if (/\b(espa√±ol|spanish|espanol)\b/.test(t)) return 'es';
      if (/\b(krey√≤l|kreyol|creole|kr√©yol)\b/.test(t)) return 'ht';

      const es = /(hola|necesito|trabajo|empleo|d√≥nde|donde|cuando|hora|horas|espa√±ol|tel[e√©]fono|direcci[o√≥]n|cita|servicios|comida|ayuda|busco)/.test(t);
      const ht = /(bonjou|bonswa|mwen|bezwen|travay|kote|ede|manje|krey[o√≤]l|telef[o√≤]n|adr[e√®]s|randevou|s[e√®]vis)/.test(t);

      if (es && !ht) return 'es';
      if (ht && !es) return 'ht';
      return lastLang; // keep current if ambiguous
    }

    function classifyIntent(text){
      const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');
      const bag = {
        trainings: /(training|trainings|program|programs|class|classes|course|courses|certification|culinary|emilio|academy|sora|forklift|apprentice|apprenticeship)\b|entrenamiento|formaci[o√≥]n|f√≤masyon/,
        jobs: /(job|jobs|work|employment|hiring|hire|opening|openings|apply|application|position|positions)\b|empleo|trabajo|travay/,
        alerts: /(alert|alerts|notify|notification|subscribe|updates|text me)/,
        resume: /(resume|curriculum|curr√≠culum|cv|cover\s*letter)/,
        interview: /(interview|interview\s*tips|mock\s*interview|practice\s*interview)/,
        appointments: /(appointment|schedule|book|meeting|register|sign\s*up|rsvp|cita|programar|randevou)\b/,
        hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|almuerzo|cena|manje)/,
        location: /(where|address|location|directions|map|parking|d[o√≥]nde|direcci[o√≥]n|ubicaci[o√≥]n|kote|adr[e√®]s)/,
        transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner)/,
        computer_lab: /(computer|internet|wifi|lab|email|application\s*online)/,
        resources: /(resource|resources|assistance|support\s*services|help\s*with|legal|id|housing)/,
        greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
        thanks: /(thanks|thank you|gracias|mesi)/,
        frustrated: /(not working|this sucks|stupid|annoying|frustrat|upset|mad|hate|waste|why won'?t|doesn'?t work)/
      };
      for (const [k, rx] of Object.entries(bag)){ if (rx.test(t)) return k; }
      return 'default';
    }

    // ---- Copy in three languages ------------------------------------------
    const COPY = {
      en: {
        greet: `üëã Welcome! Use keywords like <em>training</em>, <em>jobs</em>, <em>hours</em>, <em>address</em>, or <em>bus</em>.<br><br>
                Quick links: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Training</a> ‚Ä¢
                <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Jobs</a> ‚Ä¢
                <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alerts</a>`,
        asked: (topic)=>`<strong>‚Ä¢ You asked about ${topic}.</strong>`,
        call: `Call Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a>. During lunch (10:30 AM‚Äì1:00 PM).`,
        jobs: () => `Looking for work?<br>
            <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Open positions</a> ‚Ä¢
            <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Job alerts</a>`,
        trainings: () => `‚Ä¢ Emilio Culinary Academy (10-week)<br>‚Ä¢ SORA Security Certification<br>‚Ä¢ Forklift Certification<br><br>
            <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Browse training & apply</a>`,
        resume: () => `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Resume help & templates</a>`,
        interview: () => `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Watch interview tips</a>`,
        appointments: () => `To make an appointment:<br>Call the Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a>. During lunch (10:30 AM‚Äì1:00 PM).`,
        hours: () => `Meals: Lunch Mon‚ÄìFri 10:30a‚Äì1:00p ‚Ä¢ Dinner Mon‚ÄìThu 3:30‚Äì5:00p<br>Employment appointments are scheduled during lunch.`,
        location: () => `72¬Ω Escher St, Trenton, NJ 08609<br>
            <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Open Google Maps</a>`,
        transit: () => `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">NJ Transit Trip Planner</a> ‚Ä¢ 1-973-275-5555<br>Destination: 72¬Ω Escher St, Trenton.`,
        computer: () => `Computer lab is open during meal hours (free internet & job applications).`,
        resources: () => `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Additional resources</a> ‚Ä¢
            <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Full TASK services</a>`,
        thanks: `üòä You‚Äôre welcome!`,
        default: `I‚Äôll keep it simple. Try ‚Äútraining‚Äù, ‚Äújobs‚Äù, ‚Äúhours‚Äù, ‚Äúaddress‚Äù, ‚Äúappointment‚Äù, or ‚Äúbus‚Äù.`,
        deescalate: `I‚Äôm sorry this has been frustrating. I‚Äôll keep answers short and direct. If you‚Äôd like to talk to a person, please call <a href="tel:609-337-1624">(609) 337-1624</a>.`
      },
      es: {
        greet: `üëã ¬°Hola! Usa palabras clave como <em>entrenamiento</em>, <em>empleos</em>, <em>horarios</em>, <em>direcci√≥n</em> o <em>autob√∫s</em>.<br><br>
                Enlaces: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Entrenamientos</a> ‚Ä¢
                <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Empleos</a> ‚Ä¢
                <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas</a>`,
        asked: (t)=>`<strong>‚Ä¢ Preguntaste sobre ${t}.</strong>`,
        call: `Llama al Especialista de Servicios Sociales al <a href="tel:609-337-1624">(609) 337-1624</a>. Durante el almuerzo (10:30 AM‚Äì1:00 PM).`,
        jobs: () => `¬øBuscas trabajo?<br>
            <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Puestos disponibles</a> ‚Ä¢
            <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas de empleo</a>`,
        trainings: () => `‚Ä¢ Academia Culinaria Emilio (10 semanas)<br>‚Ä¢ Certificaci√≥n SORA (Seguridad)<br>‚Ä¢ Certificaci√≥n de Montacargas<br><br>
            <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Ver entrenamientos y aplicar</a>`,
        resume: () => `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Ayuda con el curr√≠culum</a>`,
        interview: () => `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Ver consejos de entrevista</a>`,
        appointments: () => `Para una cita:<br>Llama al <a href="tel:609-337-1624">(609) 337-1624</a>. Durante el almuerzo (10:30 AM‚Äì1:00 PM).`,
        hours: () => `Comidas: Almuerzo Lun‚ÄìVie 10:30‚Äì1:00 ‚Ä¢ Cena Lun‚ÄìJue 3:30‚Äì5:00<br>Las citas de empleo se hacen durante el almuerzo.`,
        location: () => `72¬Ω Escher St, Trenton, NJ 08609<br>
            <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Abrir Google Maps</a>`,
        transit: () => `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planificador NJ Transit</a> ‚Ä¢ 1-973-275-5555<br>Destino: 72¬Ω Escher St, Trenton.`,
        computer: () => `El laboratorio de computaci√≥n abre durante las comidas (internet gratis y solicitudes de trabajo).`,
        resources: () => `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Recursos adicionales</a> ‚Ä¢
            <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Servicios de TASK</a>`,
        thanks: `üòä ¬°Con gusto!`,
        default: `Prueba: ‚Äúentrenamientos‚Äù, ‚Äúempleos‚Äù, ‚Äúhorarios‚Äù, ‚Äúdirecci√≥n‚Äù, ‚Äúcita‚Äù o ‚Äúautob√∫s‚Äù.`,
        deescalate: `Siento la molestia. Har√© respuestas cortas y claras. Si prefieres hablar con alguien, llama al <a href="tel:609-337-1624">(609) 337-1624</a>.`
      },
      ht: {
        greet: `üëã Bonjou! Itilize mo kle tankou <em>f√≤masyon</em>, <em>travay</em>, <em>l√®</em>, <em>adr√®s</em> oswa <em>otobis</em>.<br><br>
                Lyen rapid: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">F√≤masyon</a> ‚Ä¢
                <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Travay</a> ‚Ä¢
                <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Al√®t</a>`,
        asked: (t)=>`<strong>‚Ä¢ Ou mande sou ${t}.</strong>`,
        call: `Rele Espesyalis S√®vis Sosyal la nan <a href="tel:609-337-1624">(609) 337-1624</a>. Pandan manje midi (10:30 AM‚Äì1:00 PM).`,
        jobs: () => `W ap ch√®che travay?<br>
            <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Pos travay disponib</a> ‚Ä¢
            <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Al√®t travay</a>`,
        trainings: () => `‚Ä¢ Akademi Culin√® Emilio (10 sem√®n)<br>‚Ä¢ S√®tifika SORA (Sekirite)<br>‚Ä¢ S√®tifika Forklift<br><br>
            <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Gade f√≤masyon yo & aplike</a>`,
        resume: () => `<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">√àd ak CV & mod√®l</a>`,
        interview: () => `<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Gade kons√®y ent√®vyou</a>`,
        appointments: () => `Pou randevou:<br>Rele <a href="tel:609-337-1624">(609) 337-1624</a>. Pandan manje midi (10:30 AM‚Äì1:00 PM).`,
        hours: () => `Manje: Midi Len‚ÄìVan 10:30‚Äì1:00 ‚Ä¢ Asw√® Len‚ÄìJed 3:30‚Äì5:00<br>Yo f√® randevou travay pandan manje midi.`,
        location: () => `72¬Ω Escher St, Trenton, NJ 08609<br>
            <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Louvri Google Maps</a>`,
        transit: () => `<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planifikat√® NJ Transit</a> ‚Ä¢ 1-973-275-5555<br>Destinasyon: 72¬Ω Escher St, Trenton.`,
        computer: () => `Laboratwa √≤dinat√® a louvri pandan l√® manje (ent√®n√®t gratis & aplikasyon travay).`,
        resources: () => `<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Resous adisyon√®l</a> ‚Ä¢
            <a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Tout s√®vis TASK</a>`,
        thanks: `üòä Pa gen pwobl√®m!`,
        default: `Eseye: ‚Äúf√≤masyon‚Äù, ‚Äútravay‚Äù, ‚Äúl√®‚Äù, ‚Äúadr√®s‚Äù, ‚Äúrandevou‚Äù oswa ‚Äúotobis‚Äù.`,
        deescalate: `M regr√®t si sa fristran. M ap ba w repons kout ak kl√®. Si w bezwen pale ak yon moun, rele <a href="tel:609-337-1624">(609) 337-1624</a>.`
      }
    };

    // ---- Router ------------------------------------------------------------
    function route(text){
      const lang = detectLang(text);
      lastLang = lang;
      // hint line updates to reflect what we detected
      hintEl.textContent = lang==='es' ? 'Hablo ingl√©s y espa√±ol (y Krey√≤l)'
                       : lang==='ht' ? 'M pale Angl√®, Pany√≤l & Krey√≤l'
                                      : 'I speak English, Espa√±ol & Krey√≤l';

      const intent = classifyIntent(text);
      const L = COPY[lang];

      const sections = {
        trainings: () => `${L.asked(lang==='es'?'entrenamientos':lang==='ht'?'f√≤masyon':'training')}
                          <br><br>${L.trainings()}<br><br>${L.call}`,
        jobs: () => `${L.asked(lang==='es'?'empleos':lang==='ht'?'travay':'jobs')}
                     <br><br>${L.jobs()}<br><br>${L.call}`,
        alerts: () => `${L.asked(lang==='es'?'alertas':lang==='ht'?'al√®t':'job alerts')}
                       <br><br><a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">bycell.co/ddmtr</a>`,
        resume: () => `${L.asked(lang==='es'?'curr√≠culum':lang==='ht'?'CV':'resume')}<br><br>${L.resume()}`,
        interview: () => `${L.asked(lang==='es'?'consejos de entrevista':lang==='ht'?'kons√®y ent√®vyou':'interview tips')}
                          <br><br>${L.interview()}`,
        appointments: () => `${L.asked(lang==='es'?'cita':lang==='ht'?'randevou':'an appointment')}
                             <br><br>${L.appointments()}`,  // no register link per your request
        hours: () => `${L.asked(lang==='es'?'horarios':lang==='ht'?'or√®':'hours')}<br><br>${L.hours()}`,
        location: () => `${L.asked(lang==='es'?'direcci√≥n':lang==='ht'?'adr√®s':'our location')}<br><br>${L.location()}<br><br>${L.call}`,
        transit: () => `${L.asked('bus / transit')}<br><br>${L.transit()}`,
        computer_lab: () => `${L.asked(lang==='es'?'laboratorio de computaci√≥n':lang==='ht'?'laboratwa √≤dinat√®':'computer lab')}
                             <br><br>${L.computer()}`,
        resources: () => `${L.asked(lang==='es'?'recursos':lang==='ht'?'resous':'resources')}<br><br>${L.resources()}`,
        greeting: () => L.greet,
        thanks: () => L.thanks,
        frustrated: () => L.deescalate,
        default: () => L.default
      };

      return (sections[intent]||sections.default)();
    }

    // ---- Send flow ---------------------------------------------------------
    let BUSY = false;

    function sendMessage(){
      if (BUSY) return;
      const text = (box.value || '').trim();
      if (!text) return;

      BUSY = true;
      addUser(text);
      box.value = '';
      statusEl.textContent = 'ü§ñ Thinking‚Ä¶';
      typingOn();

      setTimeout(()=>{
        typingOff();
        addBot(route(text));
        statusEl.textContent = '‚úÖ Answered!';
        setTimeout(()=> statusEl.textContent = '‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!', 1300);
        BUSY = false;
        box.focus();
      }, 260);
    }

    // Wire events
    sendBtn.addEventListener('click', sendMessage);
    box.addEventListener('keydown', e=>{
      if (e.key === 'Enter'){ e.preventDefault(); sendMessage(); }
    });
    document.getElementById('top-rail').addEventListener('click', e=>{
      const a = e.target.closest('a'); if (!a) return;
      // let browser open; no chat message
    });

    // Initial greeting (English, one clean message ‚Äî no gold chip)
    addBot(COPY.en.greet);
    box.focus();
  </script>
</body>
</html>
